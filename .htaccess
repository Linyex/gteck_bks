# Установка кодировки
AddDefaultCharset utf-8

# Запрет листинга директории
Options -Indexes

# ==== GZIP СЖАТИЕ ====
<IfModule mod_deflate.c>
    # Включаем сжатие для текстовых файлов
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/font-woff
    AddOutputFilterByType DEFLATE application/font-woff2
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# ==== КЕШИРОВАНИЕ ====
# Заголовки для изображений - 1 год
<FilesMatch "\.(jpg|jpeg|png|gif|webp|bmp|ico|svg)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Access-Control-Allow-Origin "*"
</FilesMatch>

# Заголовки для шрифтов - 1 год  
<FilesMatch "\.(ttf|woff|woff2|eot|otf)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Access-Control-Allow-Origin "*"
</FilesMatch>

# Заголовки для CSS и JS файлов - 7 дней (увеличено)
<FilesMatch "\.(css|js)$">
    Header set Cache-Control "public, max-age=604800"
    Header set Access-Control-Allow-Origin "*"
</FilesMatch>

# Заголовки для HTML файлов - без кеширования
<FilesMatch "\.(html|php)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>

RewriteEngine on 
RewriteBase /

# Разрешаем прямой доступ к статическим файлам
RewriteCond %{REQUEST_FILENAME} -f
RewriteCond %{REQUEST_URI} \.(css|js|png|jpg|jpeg|gif|webp|bmp|ico|pdf|doc|docx|xls|xlsx|zip|rar|ttf|woff|woff2|eot)$ [NC]
RewriteRule ^(.*)$ - [L]

# Разрешаем доступ к папке assets
RewriteCond %{REQUEST_URI} ^/assets/
RewriteRule ^(.*)$ - [L]

# Настройки ЧПУ для остальных запросов
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !\.(css|js|png|jpg|jpeg|gif|webp|bmp|ico|pdf|doc|docx|xls|xlsx|zip|rar|ttf|woff|woff2|eot)$ [NC]

ErrorDocument 404 /error
ErrorDocument 403 /error

RewriteRule ^(.*)$ index.php?action=$1 [L,QSA]

# Защита от хотлинкинга изображений (только для внешних доменов)
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !^http://(www\.)?gtec-bks\.by/.*$ [NC]
RewriteCond %{HTTP_REFERER} !^http://(www\.)?localhost/.*$ [NC]
RewriteCond %{HTTP_REFERER} !^http://(www\.)?127\.0\.0\.1/.*$ [NC]
RewriteCond %{HTTP_REFERER} !^http://(www\.)?nocontrgtec/.*$ [NC]
RewriteCond %{HTTP_REFERER} !^https://(www\.)?gtec-bks\.by/.*$ [NC]
RewriteCond %{HTTP_REFERER} !^https://(www\.)?localhost/.*$ [NC]
RewriteCond %{HTTP_REFERER} !^https://(www\.)?127\.0\.0\.1/.*$ [NC]
RewriteCond %{HTTP_REFERER} !^https://(www\.)?nocontrgtec/.*$ [NC]
RewriteRule \.(jpg|jpeg|gif|png|bmp|webp)$ - [F,NC]

