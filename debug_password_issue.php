<?php
require_once 'engine/main/db.php';
require_once 'engine/libs/GroupPasswordChecker.php';

echo "ðŸ” Ð”Ð˜ÐÐ“ÐÐžÐ¡Ð¢Ð˜ÐšÐ ÐŸÐ ÐžÐ‘Ð›Ð•ÐœÐ« Ð¡ ÐŸÐÐ ÐžÐ›Ð•Ðœ Ð“Ð Ð£ÐŸÐŸÐ« Ð¢111:\n\n";

// 1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ‡Ñ‚Ð¾ ÐµÑÑ‚ÑŒ Ð² Ð‘Ð” Ð´Ð»Ñ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð¢111
echo "ðŸ“Š 1. Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð¢111 Ð² Ð‘Ð”:\n";
try {
    $group = Database::fetchOne("SELECT * FROM group_passwords WHERE group_name = 'Ð¢111'");
    if ($group) {
        echo "âœ… Ð“Ñ€ÑƒÐ¿Ð¿Ð° Ð½Ð°Ð¹Ð´ÐµÐ½Ð°:\n";
        echo "   ID: " . $group['id'] . "\n";
        echo "   ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ: " . $group['group_name'] . "\n";
        echo "   ÐÐºÑ‚Ð¸Ð²Ð½Ð°: " . ($group['is_active'] ? 'Ð”Ð°' : 'ÐÐµÑ‚') . "\n";
        echo "   Ð¥ÐµÑˆ Ð¿Ð°Ñ€Ð¾Ð»Ñ: " . substr($group['password'], 0, 30) . "...\n";
        echo "   ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ: " . $group['description'] . "\n\n";
    } else {
        echo "âŒ Ð“Ñ€ÑƒÐ¿Ð¿Ð° Ð¢111 Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð° Ð² Ð‘Ð”!\n\n";
        return;
    }
} catch (Exception $e) {
    echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð‘Ð”: " . $e->getMessage() . "\n\n";
    return;
}

// 2. Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ "123"
echo "ðŸ§ª 2. Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð°Ñ€Ð¾Ð»Ñ '123':\n";
$testPassword = "123";
$result = GroupPasswordChecker::checkPassword("Ð¢111", $testPassword);
echo "Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸: " . ($result ? "âœ… Ð£Ð¡ÐŸÐ•Ð¥" : "âŒ ÐžÐ¨Ð˜Ð‘ÐšÐ") . "\n";

// 3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ…ÐµÑˆ Ð¿Ð°Ñ€Ð¾Ð»Ñ "123"
echo "\nðŸ” 3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ…ÐµÑˆÐ° Ð¿Ð°Ñ€Ð¾Ð»Ñ '123':\n";
$correctHash = password_hash("123", PASSWORD_DEFAULT);
echo "ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ñ…ÐµÑˆ Ð´Ð»Ñ '123': " . substr($correctHash, 0, 30) . "...\n";
echo "Ð¥ÐµÑˆ Ð² Ð‘Ð”: " . substr($group['password'], 0, 30) . "...\n";

// 4. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ password_verify
echo "\nðŸ” 4. ÐŸÑ€ÑÐ¼Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° password_verify:\n";
$directCheck = password_verify("123", $group['password']);
echo "password_verify('123', Ñ…ÐµÑˆ_Ð¸Ð·_Ð‘Ð”): " . ($directCheck ? "âœ… Ð’ÐµÑ€Ð½Ñ‹Ð¹" : "âŒ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹") . "\n";

// 5. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ð¿Ð°Ñ€Ð¾Ð»Ð¸
echo "\nðŸ” 5. Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð¾Ð²:\n";
$testPasswords = ["123", "t111", "T111", "Ñ‚111", "Ð¢111", "password", ""];
foreach ($testPasswords as $pwd) {
    $check = password_verify($pwd, $group['password']);
    echo "ÐŸÐ°Ñ€Ð¾Ð»ÑŒ '$pwd': " . ($check ? "âœ… Ð’ÐµÑ€Ð½Ñ‹Ð¹" : "âŒ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹") . "\n";
}

// 6. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÐµÑÑÐ¸ÑŽ
echo "\nðŸ“‹ 6. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐµÑÑÐ¸Ð¸:\n";
session_start();
if (isset($_SESSION['group_access'])) {
    echo "âœ… Ð¡ÐµÑÑÐ¸Ñ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°:\n";
    print_r($_SESSION['group_access']);
} else {
    echo "âŒ Ð¡ÐµÑÑÐ¸Ñ Ð½Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°\n";
}

echo "\n" . str_repeat("=", 50) . "\n";
echo "ðŸŽ¯ Ð—ÐÐšÐ›Ð®Ð§Ð•ÐÐ˜Ð•:\n";

if ($result) {
    echo "âœ… Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾!\n";
    echo "ðŸ’¡ Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð² Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐµ Ð¸Ð»Ð¸ ÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²ÐºÐµ\n";
} else {
    echo "âŒ ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð½Ð°Ð¹Ð´ÐµÐ½Ð°!\n";
    if (!$directCheck) {
        echo "   - ÐŸÐ°Ñ€Ð¾Ð»ÑŒ '123' Ð½Ðµ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ Ñ…ÐµÑˆÑƒ Ð² Ð‘Ð”\n";
        echo "   - Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð±Ñ‹Ð» Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½ Ð½Ðµ Ñ‡ÐµÑ€ÐµÐ· Ð°Ð´Ð¼Ð¸Ð½ÐºÑƒ\n";
    }
}

echo "\nðŸ’¡ Ð Ð•ÐšÐžÐœÐ•ÐÐ”ÐÐ¦Ð˜Ð˜:\n";
echo "1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ‡Ñ‚Ð¾ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ñ‚Ð¾Ñ‡Ð½Ð¾ '123' (Ð±ÐµÐ· Ð¿Ñ€Ð¾Ð±ÐµÐ»Ð¾Ð²)\n";
echo "2. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ñ‡ÐµÑ€ÐµÐ· Ð°Ð´Ð¼Ð¸Ð½ÐºÑƒ\n";
echo "3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²ÐºÑƒ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²\n";
?> 